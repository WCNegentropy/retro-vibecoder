retro-vibecoder-upg/
├── README.md                          # Project overview, quickstart, architecture diagram
├── ARCHITECTURE.md                    # Deep dive into design decisions (this doc)
├── CONTRIBUTING.md                    # Contributing guidelines, code style, PR process
├── LICENSE                            # MIT/Apache 2.0
│
├── packages/                          # Monorepo root (pnpm workspaces)
│
│   ├── core/                          # === PHASE 1: UNIVERSAL SPEC ===
│   │   ├── package.json
│   │   ├── src/
│   │   │   ├── schema/
│   │   │   │   ├── upg-manifest.json  # JSON Schema (meta-schema) for upg.yaml
│   │   │   │   ├── template-catalog.json  # Software Catalog schema
│   │   │   │   └── validator.ts       # AJV-based schema validator + error reporting
│   │   │   ├── transpiler/
│   │   │   │   ├── manifest-to-schema.ts  # YAML upg.yaml → JSON Schema transpiler
│   │   │   │   ├── conditional-logic.ts   # Maps when clauses → JSON Schema dependencies/oneOf
│   │   │   │   ├── jinja2-filters.ts      # Defines Jinja2 filter mappings
│   │   │   │   └── tests/
│   │   │   │       ├── transpiler.test.ts
│   │   │   │       └── fixtures/
│   │   │   │           ├── simple-prompt.yaml
│   │   │   │           ├── conditional-logic.yaml
│   │   │   │           └── expected-output/
│   │   │   ├── cli/
│   │   │   │   ├── validate.ts        # CLI: upg validate <manifest>
│   │   │   │   ├── test-generate.ts   # CLI: upg test-generate <manifest> [--data <json>]
│   │   │   │   └── docs-gen.ts        # CLI: upg docs <manifest> (generates template docs)
│   │   │   └── index.ts               # Public API exports
│   │   ├── tests/
│   │   │   ├── schema-validation.test.ts
│   │   │   ├── transpiler-e2e.test.ts
│   │   │   └── fixtures/
│   │   │       ├── react-starter.upg.yaml      # Valid fixture
│   │   │       ├── python-api.upg.yaml
│   │   │       ├── invalid-manifest.yaml       # Invalid fixture (for error testing)
│   │   │       └── edge-cases/
│   │   │           ├── circular-dependencies.yaml
│   │   │           ├── deeply-nested-conditionals.yaml
│   │   │           └── unicode-descriptions.yaml
│   │   └── README.md                  # Phase 1 docs
│   │
│   ├── engine/                        # === PHASE 2: GENERIC ENGINE (Tauri) ===
│   │   ├── src-tauri/
│   │   │   ├── Cargo.toml             # Rust dependencies + sidecar config
│   │   │   ├── tauri.conf.json        # Tauri v2 config (sidecar binaries, allowlist)
│   │   │   ├── src/
│   │   │   │   ├── main.rs            # Tauri app entry, window creation
│   │   │   │   ├── commands/
│   │   │   │   │   ├── manifest.rs    # load_manifest(path: String) → ManifestData
│   │   │   │   │   ├── generator.rs   # spawn_generator(template, dest, context) → Stream<Event>
│   │   │   │   │   ├── registry.rs    # search_registry(query) → TemplateList
│   │   │   │   │   ├── update.rs      # check_updates(project_path) → UpdateMetadata
│   │   │   │   │   └── state.rs       # read_upg_answers(project_path) → AnswersData
│   │   │   │   ├── sidecars/
│   │   │   │   │   ├── copier.rs      # Sidecar orchestration for Copier (Python)
│   │   │   │   │   ├── yeoman.rs      # Sidecar orchestration for Yeoman (Node)
│   │   │   │   │   └── executor.rs    # Generic sidecar spawn + stream capture
│   │   │   │   ├── registry/
│   │   │   │   │   ├── git.rs         # Git clone/pull logic for registry repos
│   │   │   │   │   ├── cache.rs       # Local cache management (~/.upg-cache)
│   │   │   │   │   └── search.rs      # Local search against cached manifests
│   │   │   │   ├── update/
│   │   │   │   │   ├── smart_merge.rs # 3-way merge logic (base/current/target)
│   │   │   │   │   ├── conflict.rs    # Git conflict marker insertion
│   │   │   │   │   └── state_mgr.rs   # .upg-answers.yaml read/write
│   │   │   │   └── utils/
│   │   │   │       ├── logging.rs
│   │   │   │       ├── fs.rs
│   │   │   │       └── errors.rs
│   │   │   └── binaries/
│   │   │       ├── copier-cli/        # PyInstaller bundled Copier binary (or Nuitka)
│   │   │       ├── yeoman-cli/        # esbuild bundled Yeoman binary (future)
│   │   │       └── README.md          # Binary build instructions
│   │   │
│   │   ├── src-react/                 # React Frontend (Tauri webview)
│   │   │   ├── package.json
│   │   │   ├── tsconfig.json
│   │   │   ├── vite.config.ts
│   │   │   ├── src/
│   │   │   │   ├── App.tsx            # Main app router
│   │   │   │   ├── components/
│   │   │   │   │   ├── Windows95/     # React95 wrapper components
│   │   │   │   │   │   ├── Window.tsx
│   │   │   │   │   │   ├── Button.tsx
│   │   │   │   │   │   ├── TextField.tsx
│   │   │   │   │   │   ├── Dialog.tsx
│   │   │   │   │   │   └── Panel.tsx
│   │   │   │   │   ├── TemplateSelector/
│   │   │   │   │   │   ├── TemplateCard.tsx
│   │   │   │   │   │   ├── TemplateList.tsx
│   │   │   │   │   │   └── SearchBar.tsx
│   │   │   │   │   ├── DynamicForm/
│   │   │   │   │   │   ├── FormRenderer.tsx  # RJSF wrapper with Windows95 theming
│   │   │   │   │   │   ├── FieldTemplate.tsx
│   │   │   │   │   │   ├── WidgetOverrides.tsx  # Custom widgets for special types
│   │   │   │   │   │   └── validators.ts
│   │   │   │   │   ├── GenerationFlow/
│   │   │   │   │   │   ├── ProgressBar.tsx
│   │   │   │   │   │   ├── LogViewer.tsx  # Real-time sidecar output
│   │   │   │   │   │   └── SuccessScreen.tsx
│   │   │   │   │   ├── RegistryBrowser/
│   │   │   │   │   │   ├── RegistryList.tsx
│   │   │   │   │   │   ├── TemplateDetails.tsx
│   │   │   │   │   │   └── UpdateNotification.tsx
│   │   │   │   │   └── UpdateFlow/
│   │   │   │   │       ├── UpdateChecker.tsx
│   │   │   │   │       ├── ConflictResolver.tsx  # Manual merge conflict UI
│   │   │   │   │       └── DiffViewer.tsx
│   │   │   │   ├── hooks/
│   │   │   │   │   ├── useManifest.ts
│   │   │   │   │   ├── useSidecar.ts    # Interact with Rust backend
│   │   │   │   │   ├── useRegistry.ts
│   │   │   │   │   └── useFormState.ts
│   │   │   │   ├── services/
│   │   │   │   │   ├── tauri-api.ts     # Wrapper around @tauri-apps/api
│   │   │   │   │   ├── manifest-parser.ts
│   │   │   │   │   └── schema-transpiler.ts  # Client-side YAML→JSON Schema
│   │   │   │   ├── store/
│   │   │   │   │   ├── appSlice.ts      # Redux or Zustand state management
│   │   │   │   │   ├── registrySlice.ts
│   │   │   │   │   └── store.ts
│   │   │   │   ├── styles/
│   │   │   │   │   ├── index.css        # Windows95 retro theme
│   │   │   │   │   ├── theme.ts
│   │   │   │   │   └── react95-overrides.css
│   │   │   │   └── index.tsx
│   │   │   └── tests/
│   │   │       ├── FormRenderer.test.tsx
│   │   │       ├── TemplateSelector.test.tsx
│   │   │       └── __mocks__/
│   │   │           └── @tauri-apps/api.ts
│   │   │
│   │   ├── tests/
│   │   │   ├── sidecar-integration.test.ts  # Test Copier sidecar spawn/capture
│   │   │   ├── manifest-loading.test.ts
│   │   │   ├── smart-update.test.rs        # Test 3-way merge logic
│   │   │   └── fixtures/
│   │   │       ├── sample-project/        # Pre-generated project for update testing
│   │   │       └── manifests/
│   │   │
│   │   ├── binaries/
│   │   │   ├── copier/
│   │   │   │   ├── build.sh              # PyInstaller/Nuitka build script
│   │   │   │   ├── main.py               # Entry point (wraps Copier library)
│   │   │   │   └── requirements.txt
│   │   │   └── yeoman/
│   │   │       ├── build.sh              # esbuild/pkg build script (future)
│   │   │       └── package.json
│   │   │
│   │   ├── README.md                   # Phase 2 docs
│   │   └── SIDECAR-GUIDE.md             # How to add new sidecar binaries
│   │
│   ├── registry/                       # === PHASE 3: MARKETPLACE REGISTRY ===
│   │   ├── manifests/                  # Template metadata (Git-based registry content)
│   │   │   ├── react-starter/
│   │   │   │   ├── 1.0.0.json           # Published template metadata
│   │   │   │   ├── 1.1.0.json
│   │   │   │   ├── 2.0.0.json           # Latest version
│   │   │   │   └── index.json           # Pointer to latest + metadata
│   │   │   ├── python-api/
│   │   │   │   ├── 1.0.0.json
│   │   │   │   ├── 2.0.0.json
│   │   │   │   └── index.json
│   │   │   ├── vue-storefront/
│   │   │   │   └── *.json
│   │   │   └── catalog-info.yaml        # Registry-level metadata
│   │   │
│   │   ├── templates/                  # Actual template repositories (submodules or references)
│   │   │   ├── react-starter/
│   │   │   ├── python-api/
│   │   │   └── vue-storefront/
│   │   │
│   │   ├── validation/
│   │   │   ├── ci-validate.ts           # GitHub Actions validation script
│   │   │   └── lint-manifest.ts         # Lint template manifests before merge
│   │   │
│   │   ├── README.md                   # Registry setup and publishing guide
│   │   └── PUBLISHING.md                # Template author publishing guide
│   │
│   ├── cli/                            # === COMMAND-LINE INTERFACE ===
│   │   ├── package.json
│   │   ├── src/
│   │   │   ├── bin/upg.ts               # Entry point (upg generate, upg validate, etc.)
│   │   │   ├── commands/
│   │   │   │   ├── generate.ts          # upg generate [template] [--dest] [--data]
│   │   │   │   ├── validate.ts          # upg validate <manifest>
│   │   │   │   ├── update.ts            # upg update [--project-path]
│   │   │   │   ├── registry-search.ts   # upg search <query>
│   │   │   │   ├── template-test.ts     # upg test <manifest> [--data]
│   │   │   │   └── init.ts              # upg init (interactive setup)
│   │   │   ├── utils/
│   │   │   │   ├── config.ts            # ~/.upg/config.yaml management
│   │   │   │   ├── registry-cache.ts
│   │   │   │   └── logger.ts
│   │   │   └── index.ts
│   │   └── tests/
│   │       ├── commands/
│   │       │   ├── generate.test.ts
│   │       │   └── validate.test.ts
│   │       └── fixtures/
│   │
│   └── shared/                         # === SHARED UTILITIES ===
│       ├── package.json
│       ├── src/
│       │   ├── types/
│       │   │   ├── manifest.ts          # TypeScript interfaces for upg.yaml
│       │   │   ├── registry.ts
│       │   │   ├── answers.ts
│       │   │   └── sidecar.ts
│       │   ├── constants/
│       │   │   ├── defaults.ts
│       │   │   ├── paths.ts
│       │   │   └── error-codes.ts
│       │   └── utils/
│       │       ├── yaml-parser.ts
│       │       ├── schema-validator.ts
│       │       └── paths.ts
│       └── tests/
│           └── types.test.ts
│
├── templates/                         # === EXAMPLE TEMPLATES (for testing + demos) ===
│   ├── react-starter/
│   │   ├── upg.yaml                    # Universal Manifest
│   │   ├── template/                   # Template files (Jinja2)
│   │   │   ├── package.json.jinja
│   │   │   ├── src/
│   │   │   │   ├── App.tsx.jinja
│   │   │   │   ├── index.css.jinja
│   │   │   │   └── {{cookiecutter.project_slug}}/
│   │   │   │       └── Component.tsx.jinja
│   │   │   ├── .github/workflows/
│   │   │   │   └── ci.yaml.jinja       # Conditionally included if use_ci == true
│   │   │   ├── docker/
│   │   │   │   ├── Dockerfile.jinja    # Conditional: use_docker
│   │   │   │   └── .dockerignore.jinja
│   │   │   ├── .eslintrc.json.jinja    # Conditional: use_eslint
│   │   │   └── [other files]
│   │   ├── copier.yml                  # (Legacy) For Copier tool integration
│   │   ├── hooks/ (optional)
│   │   │   ├── pre_prompt.py
│   │   │   ├── post_generation.py      # Post-generation hooks (optional)
│   │   │   └── pre_migration.py        # Pre-update hooks (smart update)
│   │   ├── catalog-info.yaml           # Software Catalog metadata
│   │   └── README.md                   # Template documentation
│   │
│   ├── python-api/
│   │   ├── upg.yaml
│   │   ├── template/
│   │   │   ├── main.py.jinja
│   │   │   ├── requirements.txt.jinja
│   │   │   ├── Dockerfile.jinja        # if use_docker
│   │   │   ├── tests/
│   │   │   │   └── test_main.py.jinja
│   │   │   └── [other files]
│   │   ├── copier.yml
│   │   ├── hooks/
│   │   │   └── post_generation.py
│   │   ├── catalog-info.yaml
│   │   └── README.md
│   │
│   ├── vue-storefront/
│   │   ├── upg.yaml
│   │   ├── template/
│   │   └── [similar structure]
│   │
│   └── monorepo-scaffold/
│       ├── upg.yaml                    # Complex example: monorepo with workspace
│       ├── template/
│       │   ├── packages/
│       │   │   ├── app/
│       │   │   │   └── package.json.jinja
│       │   │   ├── lib/
│       │   │   │   └── package.json.jinja
│       │   │   └── [conditional packages]
│       │   └── turbo.json.jinja        # if use_turborepo
│       └── upg.yaml
│
├── docs/                              # === DOCUMENTATION ===
│   ├── index.md                        # Main docs entry
│   ├── getting-started.md              # Quick start guide
│   ├── architecture/
│   │   ├── overview.md                 # Architecture diagrams + flow
│   │   ├── phase-1-spec.md             # YAML manifest spec deep dive
│   │   ├── phase-2-engine.md           # Tauri + RJSF architecture
│   │   └── phase-3-registry.md         # Git registry + smart update
│   ├── user-guide/
│   │   ├── cli-commands.md
│   │   ├── desktop-app.md
│   │   └── marketplace.md
│   ├── template-author/
│   │   ├── manifest-spec.md            # Complete upg.yaml reference
│   │   ├── examples.md                 # Template examples
│   │   ├── publishing-guide.md         # How to publish to registry
│   │   ├── best-practices.md           # Performance, security, UX tips
│   │   └── hooks-api.md                # Post-generation + pre-migration hooks
│   ├── operator-guide/
│   │   ├── private-registry.md         # Set up internal registry
│   │   ├── governance.md               # Namespace protection, review process
│   │   └── monitoring.md
│   ├── contributing/
│   │   ├── dev-setup.md
│   │   ├── running-tests.md
│   │   ├── build-sidecar.md
│   │   └── code-style.md
│   └── _sidebar.md                     # Docs navigation (Docsify/Docusaurus)
│
├── .github/
│   ├── workflows/
│   │   ├── ci.yml                      # Lint, test, build on PR
│   │   ├── validate-templates.yml      # Validate templates in registry
│   │   ├── release.yml                 # Build + publish binaries (GitHub Releases)
│   │   └── publish-docs.yml            # Deploy docs to GitHub Pages
│   ├── CODEOWNERS                      # Code ownership rules
│   ├── pull_request_template.md
│   └── issue_template/
│       ├── bug_report.md
│       └── feature_request.md
│
├── scripts/
│   ├── build-all.sh                    # Build all packages + sidecars
│   ├── test-all.sh                     # Run all tests with coverage
│   ├── validate-templates.sh           # Validate all example templates
│   ├── publish-release.sh              # Create GitHub release
│   └── setup-dev.sh                    # Dev environment setup
│
├── .editorconfig
├── .gitignore
├── pnpm-workspace.yaml                 # pnpm monorepo config
├── turbo.json                          # Turbo build orchestration
└── package.json                        # Root package (scripts, dev deps)
